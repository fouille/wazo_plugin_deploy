import"@fortawesome/fontawesome-free/js/fontawesome";import"@fortawesome/fontawesome-free/js/solid";import tippy from"tippy.js";import{App}from"@wazo/euc-plugins-sdk";import"./survey_func";import{update_sip_template_endpoint,create_nice_select,add_info_to_summary}from"./main.functions";import{codec_list_text,locale_list_wazo}from"./main.const";const clm=require("country-locale-map"),app=new App;export let template_sip_global_data_uuid="";export let host;export let tenant_uuid;export let token_session;const codec_list=JSON.parse(codec_list_text),locale_list=JSON.parse(locale_list_wazo),btn_next=document.getElementsByClassName("forward"),btn_submit=document.getElementsByClassName("submit");tippy("[data-tippy-content]",{placement:"left-start",animation:"perspective"});export const keys={codecs:[],locale:[],moh:[],nat:[]};for(let e of btn_next)e.addEventListener("click",(function(e){e.preventDefault;let t={sip_value:["!all"],label:[]},a={sip_value:[],label:[]},l={sip_value:[],label:[]},n={sip_value:[],label:[]};$("input[type=checkbox]:checked").each((function(){jQuery(this).is(":checked")&&(t.sip_value+=","+$(this).val(),t.label+=this.dataset.label+" ")})),$(".locales.selected").each((function(){a.sip_value+=this.dataset.value,a.label+=$(this).text()})),$(".moh.selected").each((function(){l.sip_value+=this.dataset.value,l.label+=$(this).text()})),$(".nat_tenant li.selected").each((function(){n.sip_value+=this.dataset.value,n.label+=$(this).text()})),keys.codecs=t,keys.locale=a,keys.moh=l,keys.nat=n,add_info_to_summary(keys)}));for(let e of btn_submit)e.addEventListener("click",(function(e){update_sip_template_endpoint(keys)}));(async()=>{await app.initialize();const e=app.getContext();tenant_uuid=e.app.extra.tenant,host="https://"+e.app.extra.instance.host,token_session=e.app.extra.instance.session.token;const t={method:"GET",headers:{"Content-Type":"application/json","Wazo-Tenant":tenant_uuid,"X-Auth-Token":token_session}},a=await fetch(host+"/api/auth/0.1/tenants?offset=0",t).then((e=>e.json())),l=await fetch(host+"/api/confd/1.1/endpoints/sip/templates?recurse=false&search=global",t).then((e=>e.json())),n=await fetch(host+"/api/confd/1.1/moh?recurse=false",t).then((e=>e.json())),s=l.items[0].endpoint_section_options;template_sip_global_data_uuid=l.items[0].uuid;const o=new Array;for(let e=0;e<s.length;e++)for(let t=0;t<s[e].length;t++)0==[t]&&(o[s[e][t]]="no value"),1==[t]&&(o[s[e][t-1]]=s[e][t]);let c=o.language;void 0===o.moh_suggest?document.getElementsByName("moh")[0].value="Option non dÃ©finie":document.getElementsByName("moh")[0].value=o.moh_suggest;let i=o.allow.split(","),p="";for(var m in i){let e=i[m];for(var _=0;_<codec_list.length;++_){let t=codec_list[_];if(t.value==e){p+=t.name+" ";break}}}let r="",u=$("#moh_tenant");for(let e=0;e<n.items.length;e++)r+='<option value="'+n.items[e].name+'">'+n.items[e].label+"</option>";u.append(r),u.each((function(){var e=$(this),t=$(this).next(".nice-select"),a=t.hasClass("open");t.length&&(t.remove(),create_nice_select(e,"moh"),a&&e.next().trigger("click"))}));let d="",h=$("#locales_tenant");for(let e=0;e<locale_list.length;e++)d+='<option data-label="'+locale_list[e].locale_text+'" value="'+locale_list[e].locale+'">'+locale_list[e].locale_text+"</option>";h.append(d),h.each((function(){let e=$(this),t=$(this).next(".nice-select"),a=t.hasClass("open");t.length&&(t.remove(),create_nice_select(e,"locales"),a&&e.next().trigger("click"))}));let f="";for(let e=0;e<codec_list.length;e++)"alaw"==codec_list[e].value?f+='<div class="form-group form-check-inline"><label class="container_check version_2">'+codec_list[e].name+'<input type="checkbox" name="active_codec" data-label="'+codec_list[e].name+'" value="'+codec_list[e].value+'" class="" checked><span class="checkmark"></span></label></div>':f+='<div class="form-group form-check-inline"><label class="container_check version_2">'+codec_list[e].name+'<input type="checkbox" name="active_codec" data-label="'+codec_list[e].name+'" value="'+codec_list[e].value+'" class=""><span class="checkmark"></span></label></div>';document.getElementById("codec_activable").innerHTML=f,document.getElementById("client_site_name").innerHTML=a.items[0].name,document.getElementsByName("lang")[0].value=clm.getCountryNameByAlpha2(c.slice(-2)),document.getElementsByName("codec")[0].value=p,"yes"===o.rtp_symmetric&&"yes"===o.rewrite_contact?document.getElementsByName("nat")[0].value="Oui":document.getElementsByName("nat")[0].value="Non"})();